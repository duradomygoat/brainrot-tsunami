<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Escape A Tsunami: Brainrot Edition</title>
<style>
body { margin:0; overflow:hidden; font-family:Arial; }
#ui { position:absolute; top:10px; left:10px; color:white; text-shadow:2px 2px 6px black; font-size:14px; }
#gameOver { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:50px; color:red; text-shadow:3px 3px 8px black; display:none; }
</style>
</head>
<body>
<div id="ui">
Money: ðŸ’° <span id="money">0</span><br>
Banked Brainrots: ðŸ§  <span id="bank">0</span><br>
Carrying: <span id="carry">0</span>
</div>
<div id="gameOver">THE TSUNAMI GOT YOU ðŸŒŠ</div>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script>
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87CEEB);

const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 5000);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.shadowMap.enabled = true;
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff,0.5));
const sun = new THREE.DirectionalLight(0xffffff,1);
sun.position.set(200,300,100);
sun.castShadow = true;
scene.add(sun);

// Ground
const ground = new THREE.Mesh(
 new THREE.PlaneGeometry(2000,5000),
 new THREE.MeshStandardMaterial({color:0x3cb043})
);
ground.rotation.x = -Math.PI/2;
ground.receiveShadow = true;
scene.add(ground);

// ===== BASE STRUCTURE =====
const base = new THREE.Group();
scene.add(base);

const floor = new THREE.Mesh(
 new THREE.BoxGeometry(40,1,40),
 new THREE.MeshStandardMaterial({color:0x888888})
);
floor.position.y = 0.5;
floor.receiveShadow = true;
base.add(floor);

const wallMat = new THREE.MeshStandardMaterial({color:0xffffff});
function wall(w,h,d,x,y,z){
 const m = new THREE.Mesh(new THREE.BoxGeometry(w,h,d), wallMat);
 m.position.set(x,y,z);
 m.castShadow = true;
 m.receiveShadow = true;
 base.add(m);
}

wall(40,20,1,0,10,-20);
wall(1,20,40,-20,10,0);
wall(1,20,40,20,10,0);

// Glass front
const glassMat = new THREE.MeshStandardMaterial({color:0x99d9ff, transparent:true, opacity:0.4});
const frontGlass = new THREE.Mesh(new THREE.BoxGeometry(40,20,1), glassMat);
frontGlass.position.set(0,10,20);
base.add(frontGlass);

// Automatic sliding door
const door = new THREE.Mesh(
 new THREE.BoxGeometry(10,15,1),
 new THREE.MeshStandardMaterial({color:0x444444})
);
door.position.set(0,7.5,20.6);
base.add(door);

// Interior lighting
const interiorLight = new THREE.PointLight(0xffffff,1,100);
interiorLight.position.set(0,15,0);
base.add(interiorLight);

// ===== SECOND FLOOR =====
const secondFloor = new THREE.Mesh(
 new THREE.BoxGeometry(38,1,38),
 new THREE.MeshStandardMaterial({color:0xaaaaaa})
);
secondFloor.position.set(0,20,0);
base.add(secondFloor);

// Stairs
for(let i=0;i<10;i++){
 const step = new THREE.Mesh(
  new THREE.BoxGeometry(4,1,2),
  new THREE.MeshStandardMaterial({color:0x777777})
 );
 step.position.set(-15,1+i*2,-10+i*2);
 base.add(step);
}

// ===== STORAGE SHELVES =====
const storage = new THREE.Group();
storage.position.set(0,1,-10);
base.add(storage);

for(let i=0;i<3;i++){
 const shelf = new THREE.Mesh(
  new THREE.BoxGeometry(20,1,3),
  new THREE.MeshStandardMaterial({color:0x663300})
 );
 shelf.position.set(0,3+i*4,-15);
 base.add(shelf);
}

// ===== VAULT ROOM =====
const vault = new THREE.Mesh(
 new THREE.BoxGeometry(10,10,10),
 new THREE.MeshStandardMaterial({color:0x999999})
);
vault.position.set(12,5,-12);
base.add(vault);

// ===== NPC SHOP =====
const npc = new THREE.Mesh(
 new THREE.BoxGeometry(2,5,2),
 new THREE.MeshStandardMaterial({color:0xff0000})
);
npc.position.set(-12,2.5,10);
base.add(npc);

// ===== PLAYER =====
const player = new THREE.Group();
function part(w,h,d,color,x,y,z){
 const m = new THREE.Mesh(new THREE.BoxGeometry(w,h,d), new THREE.MeshStandardMaterial({color}));
 m.position.set(x,y,z);
 m.castShadow = true;
 return m;
}
player.add(
 part(2,3,1.5,0x1565C0,0,3,0),
 part(1.8,1.8,1.8,0xffcc99,0,5,0),
 part(0.9,2.5,0.9,0x222222,-0.6,1.2,0),
 part(0.9,2.5,0.9,0x222222,0.6,1.2,0)
);
scene.add(player);

// ===== BRAINROT =====
function createBrainrot(){
 const group = new THREE.Group();
 const core = new THREE.Mesh(
  new THREE.SphereGeometry(1.5,32,32),
  new THREE.MeshStandardMaterial({color:0xaa00ff, emissive:0x440088})
 );
 group.add(core);

 const canvas = document.createElement('canvas');
 canvas.width = 256;
 canvas.height = 256;
 const ctx = canvas.getContext('2d');
 ctx.fillStyle='black';
 ctx.beginPath(); ctx.arc(90,120,20,0,Math.PI*2); ctx.arc(166,120,20,0,Math.PI*2); ctx.fill();
 ctx.beginPath(); ctx.arc(128,160,40,0,Math.PI); ctx.strokeStyle='black'; ctx.lineWidth=8; ctx.stroke();
 const texture = new THREE.CanvasTexture(canvas);
 const face = new THREE.Mesh(
  new THREE.PlaneGeometry(2.2,2.2),
  new THREE.MeshBasicMaterial({map:texture, transparent:true})
 );
 face.position.set(0,0,1.6);
 group.add(face);
 return group;
}

const collectibles=[];
let carried=0, banked=0, money=0;

function spawnBrainrot(x,z){
 const mesh = createBrainrot();
 mesh.position.set(x,3,z);
 scene.add(mesh);
 collectibles.push(mesh);
}
for(let i=0;i<60;i++) spawnBrainrot((Math.random()-0.5)*200,-i*80-200);

// ===== WAVE =====
const wave = new THREE.Mesh(
 new THREE.PlaneGeometry(1000,200,100,30),
 new THREE.MeshStandardMaterial({color:0x1e90ff, transparent:true, opacity:0.9, side:THREE.DoubleSide})
);
wave.position.set(0,100,-300);
scene.add(wave);

// ===== CONTROLS =====
let yaw=0, rightClick=false;
document.addEventListener('contextmenu', e=>e.preventDefault());
document.addEventListener('mousedown', e=>{ if(e.button===2) rightClick=true; });
document.addEventListener('mouseup', e=>{ if(e.button===2) rightClick=false; });
document.addEventListener('mousemove', e=>{ if(rightClick) yaw-=e.movementX*0.002; });

let speed=0.4, velocityY=0, onGround=true, gameOver=false;
const keys={};
document.addEventListener('keydown',e=>keys[e.key.toLowerCase()]=true);
document.addEventListener('keyup',e=>keys[e.key.toLowerCase()]=false);

function respawn(){
 player.position.set(0,0,10);
 wave.position.set(0,100,-300);
 speed=0.4; velocityY=0; gameOver=false;
 document.getElementById('gameOver').style.display='none';
 animate();
}

function animate(){
 if(gameOver) return;
 requestAnimationFrame(animate);

 speed+=0.00005;
 const forward = new THREE.Vector3(Math.sin(yaw),0,Math.cos(yaw));
 const right = new THREE.Vector3(forward.z,0,-forward.x);

 if(keys['w']) player.position.addScaledVector(forward,-speed);
 if(keys['s']) player.position.addScaledVector(forward,speed);
 if(keys['a']) player.position.addScaledVector(right,-speed);
 if(keys['d']) player.position.addScaledVector(right,speed);

 if(keys[' ']&&onGround){ velocityY=0.9; onGround=false; }
 velocityY-=0.05;
 player.position.y+=velocityY;
 if(player.position.y<=0){ player.position.y=0; velocityY=0; onGround=true; }

 // Door auto open
 const distToDoor = player.position.distanceTo(door.position);
 door.position.x = distToDoor < 8 ? -6 : 0;

 collectibles.forEach(c=>{
  c.rotation.y+=0.02;
  if(c.visible && player.position.distanceTo(c.position)<3){ c.visible=false; carried++; }
 });

 // Deposit
 if(player.position.length()<15 && carried>0){
  for(let i=0;i<carried;i++){
   const stored=createBrainrot();
   stored.scale.set(0.4,0.4,0.4);
   stored.position.set((Math.random()-0.5)*10,2,(Math.random()-0.5)*6-14);
   storage.add(stored);
  }
  banked+=carried;
  money+=carried*10;
  carried=0;
 }

 const pos = wave.geometry.attributes.position;
 for(let i=0;i<pos.count;i++){
  pos.setZ(i, Math.sin(i*0.2 + Date.now()*0.003)*6);
 }
 pos.needsUpdate=true;
 wave.position.z+=speed*0.9;

 if(wave.position.z+50>player.position.z){
  document.getElementById('gameOver').style.display='block';
  gameOver=true;
  setTimeout(respawn,2000);
 }

 const offset = new THREE.Vector3(0,8,20).applyAxisAngle(new THREE.Vector3(0,1,0), yaw);
 camera.position.copy(player.position).add(offset);
 camera.lookAt(player.position);

 document.getElementById('money').innerText=money;
 document.getElementById('bank').innerText=banked;
 document.getElementById('carry').innerText=carried;

 renderer.render(scene,camera);
}
animate();

window.addEventListener('resize',()=>{
 camera.aspect=window.innerWidth/window.innerHeight;
 camera.updateProjectionMatrix();
 renderer.setSize(window.innerWidth,window.innerHeight);
});
</script>
</body>
</html>

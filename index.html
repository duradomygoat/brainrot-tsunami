<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Escape The Tsunami - Deluxe Edition</title>
<style>
body { margin:0; overflow:hidden; font-family:Arial; }
#ui {
  position:absolute; top:10px; left:10px;
  color:white; text-shadow:2px 2px 6px black;
  font-size:14px;
}
#gameOver {
  position:absolute; top:50%; left:50%;
  transform:translate(-50%,-50%);
  font-size:50px; color:red;
  text-shadow:3px 3px 8px black;
  display:none;
}
</style>
</head>
<body>

<div id="ui">
Score: <span id="score">0</span><br>
Money: ðŸ’° <span id="money">0</span><br>
Speed: <span id="speed">0</span>
</div>
<div id="gameOver">YOU GOT WASHED ðŸŒŠ</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script>
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87CEEB);
scene.fog = new THREE.Fog(0x87CEEB, 50, 800);

const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 5000);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.shadowMap.enabled = true;
document.body.appendChild(renderer.domElement);

// Lighting
scene.add(new THREE.AmbientLight(0xffffff,0.6));
const sun = new THREE.DirectionalLight(0xffffff,1);
sun.position.set(100,200,100);
sun.castShadow = true;
scene.add(sun);

// Ground with grid detail
const groundGeo = new THREE.PlaneGeometry(5000,5000,50,50);
const groundMat = new THREE.MeshStandardMaterial({color:0x3cb043});
const ground = new THREE.Mesh(groundGeo, groundMat);
ground.rotation.x = -Math.PI/2;
ground.receiveShadow = true;
scene.add(ground);

// Roblox-style Avatar (simple block humanoid)
const player = new THREE.Group();

const torso = new THREE.Mesh(
  new THREE.BoxGeometry(2,3,1.5),
  new THREE.MeshStandardMaterial({color:0x1565C0})
);
torso.position.y = 3;
torso.castShadow = true;

const head = new THREE.Mesh(
  new THREE.BoxGeometry(1.8,1.8,1.8),
  new THREE.MeshStandardMaterial({color:0xffcc99})
);
head.position.y = 5;
head.castShadow = true;

const leftArm = new THREE.Mesh(
  new THREE.BoxGeometry(0.8,2.5,0.8),
  new THREE.MeshStandardMaterial({color:0xffcc99})
);
leftArm.position.set(-1.5,3,0);

const rightArm = leftArm.clone();
rightArm.position.x = 1.5;

const leftLeg = new THREE.Mesh(
  new THREE.BoxGeometry(0.9,2.5,0.9),
  new THREE.MeshStandardMaterial({color:0x222222})
);
leftLeg.position.set(-0.6,1.25,0);

const rightLeg = leftLeg.clone();
rightLeg.position.x = 0.6;

player.add(torso, head, leftArm, rightArm, leftLeg, rightLeg);
scene.add(player);

// Detailed Brainrot Towers
const obstacles = [];
function spawnTower(z){
  const group = new THREE.Group();
  const base = new THREE.Mesh(
    new THREE.CylinderGeometry(2,3,6,16),
    new THREE.MeshStandardMaterial({color:0x888888})
  );
  base.position.y = 3;
  const top = new THREE.Mesh(
    new THREE.ConeGeometry(2.5,3,16),
    new THREE.MeshStandardMaterial({color:0x9900ff})
  );
  top.position.y = 7;
  group.add(base,top);
  group.position.set((Math.random()-0.5)*200,0,z);
  scene.add(group);
  obstacles.push(group);
}
for(let i=0;i<100;i++) spawnTower(-i*80-200);

// Animated Water Wall
const waveGeo = new THREE.PlaneGeometry(5000,200,100,50);
const waveMat = new THREE.MeshStandardMaterial({color:0x1e90ff, side:THREE.DoubleSide});
const wave = new THREE.Mesh(waveGeo, waveMat);
wave.position.set(0,100,-300);
scene.add(wave);

camera.position.set(0,10,20);

let score=0, money=0;
let baseSpeed=0.3;
let velocityY=0, onGround=true;
let gameOver=false;

const keys={};
document.addEventListener('keydown',e=>keys[e.key.toLowerCase()]=true);
document.addEventListener('keyup',e=>keys[e.key.toLowerCase()]=false);

function animate(){
 if(gameOver) return;
 requestAnimationFrame(animate);

 baseSpeed+=0.00005;
 const speed=baseSpeed*(keys['shift']?2:1);

 if(keys['w']) player.position.z-=speed;
 if(keys['s']) player.position.z+=speed;
 if(keys['a']) player.position.x-=speed;
 if(keys['d']) player.position.x+=speed;

 if(keys[' ']&&onGround){ velocityY=0.8; onGround=false; }
 velocityY-=0.04;
 player.position.y+=velocityY;
 if(player.position.y<=0){ player.position.y=0; velocityY=0; onGround=true; }

 // Animate wave vertices
 const pos = wave.geometry.attributes.position;
 for(let i=0;i<pos.count;i++){
   const y = Math.sin(i*0.3 + Date.now()*0.005)*5;
   pos.setZ(i,y);
 }
 pos.needsUpdate=true;

 wave.position.z+=baseSpeed*0.8;

 camera.position.x=player.position.x;
 camera.position.z=player.position.z+20;
 camera.lookAt(player.position);

 if(wave.position.z+50>player.position.z){
   document.getElementById('gameOver').style.display='block';
   gameOver=true;
 }

 score++;
 document.getElementById('score').innerText=score;
 document.getElementById('money').innerText=money;
 document.getElementById('speed').innerText=speed.toFixed(2);

 renderer.render(scene,camera);
}
animate();

window.addEventListener('resize',()=>{
 camera.aspect=window.innerWidth/window.innerHeight;
 camera.updateProjectionMatrix();
 renderer.setSize(window.innerWidth,window.innerHeight);
});
</script>
</body>
</html>
